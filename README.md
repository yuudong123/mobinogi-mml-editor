2025-09-13
다시 구현했습니다...... 힘들다..



중간템포 지원기능을 일시적으로 없애고 초반템포 하나만 지원하는 방식으로 롤백했습니다.

사유는 다음과 같습니다.

1. 중간템포를 위해 수정한 버전을 다시 불러올때 악보가 깨짐

초기템포 120을 받는 구간이 있고 뒤에 200을 받는 구간이 있다고하자.
첫구간에 트랙1에 400노트, 트랙2에 600노트가 있으면 트랙1에서 200개의 r을 추가한다. 그럼 최소 l256단위를 사용해서 음표를 쪼개야하는데 이때 256은 tpqn이 480일때 tick이 7.5가 나온다. 정수로 나누어떨어지지 않으면 조금씩 밀리기 시작한다.

아마 인게임에선 l이 몇이든지 상관없이 거의 정확하게 연주될거다. 근데 tick기반으로 mml을 불러오는 마비꼬나 내 에디터에서 못불러올때 깨진다.. 한번 변환한 곡을 다시 에디터로 못넣는게 말이 되냐?
이걸 위해 tpqn 자체를 늘리면 웹에서 성능에 영향이 간다. 마비꼬는 자바를 사용해서 이런 연산을 몇배는 빠르게 가능하지만 웹에선 눈에 띄게 차이난다



2. 글자수 늘어나는게 너무 많다.

멜로디 - 반주/베이스 간 글자수 차이가 엄청 많이 나는데 변속이 늦게 들어간 곡일수록 노트개수가 300개가량 차이가 나는 경우도 있다 (https://arca.live/b/mabimobile/147347078 prince ali가 그랬음, 후반부에 깨짐 지금도)
차라리 이 방식보다, 노트를 늘리는 방식으로 작업하는게 더 낫다. (정확한 템포는 불가능하겠지만 안정적)
