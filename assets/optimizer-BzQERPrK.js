const a=new Worker(new URL(""+new URL("mmlOptimizerWorker-DAJdBDKe.js",import.meta.url).href,import.meta.url),{type:"module"});a.onmessage=e=>{try{const{trackId:r,optimizedMML:t,originalBody:c}=e.data,n=window.mobileApp,s=n?.getProject?.();if(!s)return;const o=s.tracks.find(d=>d.id===r);if(!o)return;const m=Array.isArray(o.notes)&&o.notes.length>0;t&&t.length>0?o.optimizedMML=t:(!m||e.data.notesLen===0)&&(o.optimizedMML=""),o.originalBody=c??"",e.data.error&&window?.console&&console.warn("[mmlOptimizerWorker error]",e.data.error),e.data.safeMode&&window?.console&&!window.__MML_SAFE_MODE_NOTIFIED&&(window.__MML_SAFE_MODE_NOTIFIED=!0,console.warn("[mmlOptimizerWorker] Safe mode enabled due to first error:",e.data.firstError));const i=n?.getUIControls?.();i&&typeof i.refreshTracksPanel=="function"&&i.refreshTracksPanel()}catch{}};function p(e,r){try{a.postMessage({trackId:r.id,notes:r.notes?.map(t=>({id:t.id,startTick:t.startTick,durationTick:t.durationTick,pitch:t.pitch,volume:t.volume}))||[],tpqn:e.tpqn,tempoAnchors:e.tempoAnchors?.map(t=>({tempo:t.bpm??t.tempo,tickOffset:t.tick??t.tickOffset}))||[]})}catch{}}function l(e){if(e)for(const r of e.tracks)p(e,r)}export{l as scheduleOptimizeAll,p as scheduleOptimizeTrack};
